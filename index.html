<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WhatsApp Pair Code Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <style>
    /* same CSS as your original file */
    /* I kept your full styling, only shortened here for space */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo"><i class="fas fa-robot"></i></div>
      <h1 class="title">WhatsApp Linker</h1>
      <p class="subtitle">Link your WhatsApp device</p>
    </div>

    <!-- Toggle -->
    <div class="toggle-container">
      <div class="toggle-option active" data-mode="pair"><i class="fas fa-key"></i> Pair Code</div>
      <div class="toggle-option" data-mode="qr"><i class="fas fa-qrcode"></i> QR Code</div>
    </div>

    <div class="input-group" id="inputGroup">
      <label class="input-label">Enter your WhatsApp number with country code</label>
      <input type="text" id="mobileNumber" class="input-field" placeholder="+15551234567">
    </div>

    <button class="generate-btn" id="submit"><i class="fas fa-key"></i> Generate Pair Code</button>

    <div class="loading" id="loading"><i class="fas fa-spinner"></i></div>

    <div class="code-display" id="codeDisplay">Your pair code will appear here</div>

    <div class="qr-display" id="qrDisplay">
      <img id="qrImage" class="qr-image" src="" alt="QR Code">
      <div class="qr-instructions" id="qrInstructions"></div>
    </div>

    <button class="copy-btn" id="copy" onclick="copyCode()"><i class="fas fa-copy"></i> Copy Code</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
  <script>
    let currentMode = 'pair';

    document.querySelectorAll('.toggle-option').forEach(option => {
      option.addEventListener('click', function() {
        const mode = this.dataset.mode;
        if (mode === currentMode) return;
        document.querySelectorAll('.toggle-option').forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
        currentMode = mode;
        if (mode === 'pair') {
          document.getElementById('submit').classList.remove('hidden');
          document.getElementById('inputGroup').classList.remove('hidden');
        } else {
          document.getElementById('submit').classList.add('hidden');
          document.getElementById('inputGroup').classList.add('hidden');
          generateQRCode();
        }
        document.getElementById('codeDisplay').innerHTML = 'Your pair code will appear here';
        document.getElementById('qrDisplay').style.display = 'none';
      });
    });

    async function generateQRCode() {
      const loading = document.getElementById("loading");
      loading.style.display = "block";
      try {
        const response = await axios('/api/qr');
        if (response.data.qr) {
          document.getElementById('qrImage').src = response.data.qr;
          document.getElementById('qrInstructions').innerHTML = response.data.instructions.join('<br>');
          document.getElementById('qrDisplay').style.display = 'block';
          document.getElementById('codeDisplay').style.display = 'none';
        }
      } catch {
        document.getElementById('codeDisplay').innerHTML = '<div class="error-message">Failed to generate QR</div>';
      } finally {
        loading.style.display = "none";
      }
    }

    document.getElementById("submit").addEventListener("click", async (e) => {
      e.preventDefault();
      const mobileNumber = document.getElementById("mobileNumber").value.trim();
      if (!mobileNumber) return;
      const loading = document.getElementById("loading");
      loading.style.display = "block";
      try {
        const response = await axios(`/api/pair?number=${mobileNumber.replace(/[^0-9]/g, "")}`);
        if (response.data.code) {
          document.getElementById("codeDisplay").innerHTML = `<div class="success-message">CODE: ${response.data.code}</div>`;
        }
      } catch {
        document.getElementById("codeDisplay").innerHTML = '<div class="error-message">Error generating code</div>';
      } finally {
        loading.style.display = "none";
      }
    });

    function copyCode() {
      const code = document.getElementById("codeDisplay").innerText.replace("CODE: ", "");
      navigator.clipboard.writeText(code);
    }
  </script>
</body>
</html>
